{% extends 'base.html' %}

{% block content %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="flashes">
    {% for category, message in messages %}
      <li class="{{ category }}">{{ message }}</li>
    {% endfor %}
    </ul>
  {% endif %}
{% endwith %}


<form action="#" method="POST">
    <h2>Enter molecule in SMILES format:</h2>
    <p> <input type="text" name="smiles" required/> </p>
    <p> <button type="submit" value="smiles">submit</button> </p>
</form>

<br>
<br>

<h2>Enter CSV file (containing TWO (2) columns):</h2>
<form action="{{ url_for('upload') }}" method="POST" enctype="multipart/form-data">
    <div id="drop-area">
        <p><strong>Drag & drop your file here:</strong></p>
        <input type="file" id="fileElem" name="file" accept=".csv" hidden>
    </div>
</form>

<script>
const dropArea = document.getElementById('drop-area');
const fileInput = document.getElementById('fileElem');

dropArea.addEventListener('click', () => fileInput.click());

dropArea.addEventListener('dragover', (e) => {
  e.preventDefault();
  dropArea.classList.add('hover');
});

dropArea.addEventListener('dragleave', () => dropArea.classList.remove('hover'));

dropArea.addEventListener('drop', (e) => {
  e.preventDefault();
  dropArea.classList.remove('hover');
  fileInput.files = e.dataTransfer.files;
  setTimeout(() => fileInput.form.submit(), 100);  // Automatically submits form
});

fileInput.addEventListener('change', () => {
    if (fileInput.files.length > 0) {
        setTimeout(() => fileInput.form.requestSubmit(), 100);
  }
});

window.addEventListener("dragover", e => e.preventDefault());
window.addEventListener("drop", e => e.preventDefault());
</script>

{% endblock %}